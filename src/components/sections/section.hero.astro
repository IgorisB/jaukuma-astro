---
import ControlNavbarDesktop from '../controls/control.navbar.desktop.astro';
import ControlNavbarMobile from '../controls/control.navbar.mobile.astro';
import ControlStickyHeaderMobile from '../controls/control.sticky-header.mobile.astro';
import { useTranslations, getLangFromUrl } from '../../lib/utils';
const lang = Astro.props.locale || getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section class="hero-section parallax-hero">
  <!-- Parallax Background Layer -->
  <div class="parallax-background" style="background-image: linear-gradient(rgba(50, 62, 72, 0.6), rgba(50, 62, 72, 0.6)), url('/images/hero-background.jpg')"></div>
  
  <!-- Parallax Content Layer -->
  <div class="parallax-content">
    <!-- Navigation Bar -->
    <ControlNavbarDesktop locale={lang} />
    <ControlNavbarMobile locale={lang} />
    
    <!-- Sticky Mobile Header -->
    <ControlStickyHeaderMobile locale={lang} />
    
    <!-- Hero Content -->
    <div class="hero-content">
        <p class="main-title color-white" set:html={t('section.hero.slogan')}></p>
        <h1 class="hidden">{t('section.hero.title')}</h1>
        <p class="description color-white" set:html={t('section.hero.description')}></p>
        <a href="#services" class="button-primary-light">
          {t('section.hero.button')}
        </a>
    </div>
    <a href="#about" class="scroll-down">
      <img src="/images/down-arrow-circle.svg" alt="Scroll Down" />
    </a>
  </div>
</section>

<script is:inline>
  // Initialize parallax when document is ready
  function initParallax() {
    const parallaxHero = document.querySelector('.parallax-hero');
    const parallaxBackground = document.querySelector('.parallax-background');
    
    if (parallaxHero && parallaxBackground) {
      function updateParallax() {
        const scrollY = window.pageYOffset || window.scrollY || document.documentElement.scrollTop;
        const heroRect = parallaxHero.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        
        // Calculate if hero is in viewport
        const isInViewport = heroRect.bottom > 0 && heroRect.top < windowHeight;
        
        if (isInViewport) {
          // Simple parallax calculation
          const parallaxOffset = scrollY * 0.3;
          parallaxBackground.style.transform = `translate3d(0, ${parallaxOffset}px, 0)`;
        }
      }
      
      // Add event listener
      window.addEventListener('scroll', updateParallax, { passive: true });
      
      // Initial call
      updateParallax();
    }
  }
  
  // Initialize smooth scroll for all anchor links
  function initSmoothScroll() {
    // Handle scroll down button
    const scrollDownButton = document.querySelector('.scroll-down');
    
    if (scrollDownButton) {
      scrollDownButton.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.offsetTop;
          const headerOffset = 80; // Account for sticky header
          
          window.scrollTo({
            top: offsetTop - headerOffset,
            behavior: 'smooth'
          });
        }
      });
    }
    
    // Handle hero button
    const heroButton = document.querySelector('.hero-content .button-primary-light');
    
    if (heroButton) {
      heroButton.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.offsetTop;
          const headerOffset = 80; // Account for sticky header
          
          window.scrollTo({
            top: offsetTop - headerOffset,
            behavior: 'smooth'
          });
        }
      });
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      initParallax();
      initSmoothScroll();
    });
  } else {
    initParallax();
    initSmoothScroll();
  }
  
  // Backup initialization on window load
  window.addEventListener('load', function() {
    initParallax();
    initSmoothScroll();
  });
</script>
<style>
  .hero-section {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    padding: 2.25rem 9rem 9rem 9rem;
    gap: 9rem;
    /* Remove background styles - now handled by parallax-background */
  }

  /* Parallax content maintains flex layout */
  .parallax-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 9rem;
    width: 100%;
    height: 100%;
  }

  /* Hero Content */
  .hero-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    margin: 0 auto;
    gap: 40px;
    text-align: center;
  }

  /* Scroll Down Button */
  .scroll-down {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3rem;
    height: 3rem;
    background: transparent;
    border-radius: 50%;
    transition: all 0.3s ease;
    animation: bounce 2s infinite;
  }

  .scroll-down:hover {
    transform: translateY(-5px);
  }

  .scroll-down img {
    width: 3rem;
    height: 3rem;
    filter: none;
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-10px);
    }
    60% {
      transform: translateY(-5px);
    }
  }

  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .scroll-down {
      animation: none;
    }
    
    html {
      scroll-behavior: auto;
    }
  }

  /* Media queries */
  @media (min-width: 1024px) {
    .hero-section {
      padding: 2.25rem 9rem 9rem 9rem;
    }
  } 

  @media (min-width: 768px) and (max-width: 1024px) {
    .hero-section {
      padding: 1.5rem 3rem;
    }
  }

  @media (max-width: 768px) {
    .hero-section {
      padding: 0.75rem 1.5rem 1.5rem 1.5rem;
    }

    .scroll-down {
      width: 2.5rem;
      height: 2.5rem;
    }

    .scroll-down img {
      width: 2.5rem;
      height: 2.5rem;
    }
  }
</style>