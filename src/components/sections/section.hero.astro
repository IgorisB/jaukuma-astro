---
import ControlNavbarDesktop from '../controls/control.navbar.desktop.astro';
import ControlNavbarMobile from '../controls/control.navbar.mobile.astro';
import ControlStickyHeaderMobile from '../controls/control.sticky-header.mobile.astro';
import { useTranslations, getLangFromUrl } from '../../lib/utils';
const lang = Astro.props.locale || getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section class="hero-section parallax-hero">
  <!-- Parallax Background Layer -->
  <div class="parallax-background" style="background-image: linear-gradient(rgba(50, 62, 72, 0.6), rgba(50, 62, 72, 0.6)), url('/images/hero-background.jpg')"></div>
  
  <!-- Parallax Content Layer -->
  <div class="parallax-content">
    <!-- Navigation Bar -->
    <ControlNavbarDesktop locale={lang} />
    <ControlNavbarMobile locale={lang} />
    
    <!-- Sticky Mobile Header -->
    <ControlStickyHeaderMobile locale={lang} />
    
    <!-- Hero Content -->
    <div class="hero-content">
        <p class="main-title color-white" set:html={t('section.hero.slogan')}></p>
        <h1 class="hidden">{t('section.hero.title')}</h1>
        <p class="description color-white" set:html={t('section.hero.description')}></p>
        <a href="#services" class="button-primary-light">
          {t('section.hero.button')}
        </a>
    </div>
    <a href="#about-video" class="scroll-down">
      <img src="/images/down-arrow-circle.svg" alt="Scroll Down" />
    </a>
  </div>
</section>

<script is:inline>
  // Initialize parallax when document is ready
  function initParallax() {
    const parallaxHero = document.querySelector('.parallax-hero');
    const parallaxBackground = document.querySelector('.parallax-background');
    
    if (parallaxHero && parallaxBackground) {
      function updateParallax() {
        const scrollY = window.pageYOffset || window.scrollY || document.documentElement.scrollTop;
        const heroRect = parallaxHero.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        
        // Calculate if hero is in viewport
        const isInViewport = heroRect.bottom > 0 && heroRect.top < windowHeight;
        
        if (isInViewport) {
          // Simple parallax calculation
          const parallaxOffset = scrollY * 0.3;
          parallaxBackground.style.transform = `translate3d(0, ${parallaxOffset}px, 0)`;
        }
      }
      
      // Add event listener
      window.addEventListener('scroll', updateParallax, { passive: true });
      
      // Initial call
      updateParallax();
    }
  }
  
  // Initialize smooth scroll for all anchor links
  function initSmoothScroll() {
    // Handle scroll down button
    const scrollDownButton = document.querySelector('.scroll-down');
    
    if (scrollDownButton) {
      scrollDownButton.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.offsetTop;
          const headerOffset = 80; // Account for sticky header
          
          window.scrollTo({
            top: offsetTop - headerOffset,
            behavior: 'smooth'
          });
        } else {
          // Fallback: try to find element by name or other means
          console.warn('Could not find element with id:', targetId);
        }
      });
    }
    
    // Handle hero button
    const heroButton = document.querySelector('.hero-content .button-primary-light');
    
    if (heroButton) {
      heroButton.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.offsetTop;
          const headerOffset = 80; // Account for sticky header
          
          window.scrollTo({
            top: offsetTop - headerOffset,
            behavior: 'smooth'
          });
        }
      });
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      initParallax();
      initSmoothScroll();
    });
  } else {
    initParallax();
    initSmoothScroll();
  }
  
  // Backup initialization on window load
  window.addEventListener('load', function() {
    initParallax();
    initSmoothScroll();
  });
  
  // Ensure scroll down button works even if there are conflicts
  document.addEventListener('click', function(e) {
    const target = e.target.closest('.scroll-down');
    if (target) {
      e.preventDefault();
      const targetId = target.getAttribute('href').substring(1);
      const targetElement = document.getElementById(targetId);
      if (targetElement) {
        const offsetTop = targetElement.offsetTop;
        const headerOffset = 80; // Account for sticky header
        
        window.scrollTo({
          top: offsetTop - headerOffset,
          behavior: 'smooth'
        });
      } else {
        // Fallback: try standard anchor scrolling
        console.warn('Could not find element with id:', targetId);
        window.location.hash = targetId;
      }
    }
  });
</script>

<script is:inline>
  import '../../scripts/parallax.ts';
</script>

<style>
  .hero-section {
    @apply relative flex flex-col items-center text-light gap-36 p-9 pb-36 md:px-12 md:py-6 lg:px-36 lg:py-9 lg:pb-36;
  }

  /* Parallax content maintains flex layout */
  .parallax-content {
    @apply flex flex-col items-center gap-36 w-full h-full;
  }

  /* Hero Content */
  .hero-content {
    @apply flex flex-col justify-center items-center w-full mx-auto gap-10 text-center;
  }

  /* Scroll Down Button */
  .scroll-down {
    @apply flex items-center justify-center w-12 h-12 bg-transparent rounded-full transition-all duration-300 animate-bounce;
  }

  .scroll-down:hover {
    @apply -translate-y-1;
  }

  .scroll-down img {
    @apply w-12 h-12;
    filter: none;
  }

  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .scroll-down {
      animation: none;
    }

    html {
      scroll-behavior: auto;
    }
  }

  @media (max-width: 768px) {
    .scroll-down {
      @apply w-10 h-10;
    }

    .scroll-down img {
      @apply w-10 h-10;
    }
  }
</style>